<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Romantic Spin Wheel ðŸ’–</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@400;600&display=swap');

        :root {
            --primary-pink: #ff85a2;
            --soft-pink: #ffc1e3;
            --deep-pink: #ff4d6d;
            --white-glass: rgba(255, 255, 255, 0.85);
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #ffdee9 0%, #b5fffc 100%);
            min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            overflow-x: hidden;
        }

        .container { width: 95%; max-width: 450px; z-index: 10; margin: 20px auto; }

        .main-card {
            background: var(--white-glass);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(255, 133, 162, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.6);
        }

        h1 { font-family: 'Dancing Script', cursive; font-size: clamp(28px, 8vw, 38px); color: var(--deep-pink); margin: 0 0 10px 0; }

        /* ðŸŽ¡ Responsive Spin Wheel */
        .wheel-outer-ring {
            position: relative;
            width: 280px; height: 280px;
            margin: 25px auto;
            border: 10px solid white;
            border-radius: 50%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            background: white;
            display: flex; align-items: center; justify-content: center;
        }

        @media (min-width: 480px) { .wheel-outer-ring { width: 340px; height: 340px; } }

        .pointer-tab {
            position: absolute; top: -22px; left: 50%; transform: translateX(-50%);
            z-index: 100; width: 35px; height: 45px;
            background: var(--deep-pink); clip-path: polygon(50% 100%, 0 0, 100% 0);
        }

        .center-hub {
            position: absolute; width: 45px; height: 45px;
            background: white; border-radius: 50%; z-index: 50;
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
            display: flex; align-items: center; justify-content: center;
            border: 3px solid var(--soft-pink);
        }

        #wheel {
            width: 100% !important; height: 100% !important;
            border-radius: 50%;
            transition: transform 5s cubic-bezier(0.15, 0, 0.1, 1);
        }

        .options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 20px 0; }

        .opt-btn {
            background: white; border: none; padding: 12px 8px; border-radius: 15px;
            cursor: pointer; font-weight: 600; color: #555; transition: 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05); font-size: 12px;
        }

        .opt-btn.selected { background: var(--primary-pink); color: white; transform: translateY(-2px); }

        .btn-action {
            background: linear-gradient(45deg, var(--deep-pink), var(--primary-pink));
            color: white; border: none; padding: 14px 40px; border-radius: 30px;
            font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; max-width: 250px;
            box-shadow: 0 8px 20px rgba(255, 77, 109, 0.3);
        }

        .btn-action:disabled { background: #ccc; box-shadow: none; cursor: not-allowed; }

        .hidden { display: none; }
        .res-tag { background: white; padding: 10px 15px; border-radius: 15px; margin: 4px; display: inline-block; color: var(--deep-pink); font-weight: bold; font-size: 14px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }

        .heart-bg { position: fixed; top: -10%; font-size: 20px; color: var(--primary-pink); opacity: 0.2; pointer-events: none; animation: fall linear infinite; z-index: 0; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
    </style>
</head>
<body>

    <div id="heart-layer"></div>

    <div class="container">
        <div id="select-screen" class="main-card">
            <h1>Activity Picks ðŸŽ€</h1>
            <p style="color: #888; font-size: 14px;">Select 5 items for the wheel</p>
            <div id="grid" class="options-grid"></div>
            <button id="next-btn" class="btn-action" disabled>Continue âœ¨</button>
        </div>

        <div id="wheel-screen" class="main-card hidden">
            <h1>Spin the Love ðŸŽ¡</h1>
            <div class="wheel-outer-ring">
                <div class="pointer-tab"></div>
                <div class="center-hub">ðŸ’–</div>
                <canvas id="wheel" width="800" height="800"></canvas>
            </div>
            <button id="spin-btn" class="btn-action">SPIN ðŸ’˜</button>
            <p id="count-text" style="margin-top:15px; font-weight:bold; color:#777; font-size: 14px;">3 Spins Left</p>
        </div>

        <div id="final-screen" class="main-card hidden">
            <h1>Our Plan ðŸŒ¸</h1>
            <div id="final-results"></div>
            <p style="margin-top:20px; font-style: italic; color: #666;">I love you! ðŸ¥°</p>
            <button onclick="location.reload()" class="btn-action">Play Again</button>
        </div>

        <div id="log" style="text-align:center; margin-top:10px;"></div>
    </div>

    <script>
        const activities = [
            "ðŸ¦ Ice Cream", "ðŸ› Shopping", "ðŸŽ Surprise", 
            "ðŸœ Fav Food", "ðŸ˜˜ 10 Kisses", "ðŸ¤— Long Hug", 
            "ðŸŽ¤ Sing Song", "ðŸ« Chocolate", "ðŸ’ƒ Dance 30s"
        ];
        
        let picked = [];
        let spins = 3;
        let rot = 0;
        const won = [];

        // Animation Background
        setInterval(() => {
            const h = document.createElement('div');
            h.className = 'heart-bg'; h.innerHTML = 'â¤';
            h.style.left = Math.random() * 100 + 'vw';
            h.style.animationDuration = (Math.random() * 3 + 4) + 's';
            document.getElementById('heart-layer').appendChild(h);
            setTimeout(() => h.remove(), 7000);
        }, 800);

        // Selection Grid
        const grid = document.getElementById('grid');
        activities.forEach(a => {
            const b = document.createElement('button');
            b.className = 'opt-btn'; b.innerText = a;
            b.onclick = () => {
                if(picked.includes(a)) {
                    picked = picked.filter(x => x !== a);
                    b.classList.remove('selected');
                } else if(picked.length < 5) {
                    picked.push(a);
                    b.classList.add('selected');
                }
                document.getElementById('next-btn').disabled = picked.length !== 5;
            };
            grid.appendChild(b);
        });

        document.getElementById('next-btn').onclick = () => {
            document.getElementById('select-screen').classList.add('hidden');
            document.getElementById('wheel-screen').classList.remove('hidden');
            // Timeout to ensure canvas is visible before drawing
            setTimeout(draw, 100);
        };

        const canvas = document.getElementById('wheel');
        const ctx = canvas.getContext('2d');

        function draw() {
            const n = picked.length;
            const centerX = 400;
            const centerY = 400;
            const radius = 380;
            const sliceAngle = (Math.PI * 2) / n;

            ctx.clearRect(0, 0, 800, 800);

            picked.forEach((text, i) => {
                const startAngle = i * sliceAngle;
                
                // Draw Slice
                ctx.beginPath();
                ctx.fillStyle = i % 2 === 0 ? '#ff85a2' : '#ffb6c1';
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
                ctx.closePath();
                ctx.fill();

                // Draw White Border
                ctx.strokeStyle = "rgba(255,255,255,0.8)";
                ctx.lineWidth = 4;
                ctx.stroke();

                // Draw Text
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(startAngle + sliceAngle / 2);
                
                ctx.fillStyle = "white";
                ctx.textAlign = "right";
                ctx.font = "bold 36px Poppins"; // High resolution font size
                ctx.shadowBlur = 4;
                ctx.shadowColor = "rgba(0,0,0,0.2)";

                // Ensure the emoji and text stay inside the slice
                const displayText = text.length > 15 ? text.substring(0, 13) + ".." : text;
                ctx.fillText(displayText, radius - 40, 10);
                
                ctx.restore();
            });
        }

        document.getElementById('spin-btn').onclick = function() {
            if (spins <= 0) return;
            this.disabled = true;

            const extraRot = Math.floor(Math.random() * 360) + 1800; // 5 full rotations min
            rot += extraRot;
            canvas.style.transform = `rotate(${rot}deg)`;

            setTimeout(() => {
                const sliceDeg = 360 / picked.length;
                const winIdx = Math.floor(((360 - (rot % 360) + 270) % 360) / sliceDeg);
                const winner = picked[winIdx];

                won.push(winner);
                document.getElementById('log').innerHTML += `<div class="res-tag">ðŸ’– ${winner}</div>`;
                
                // Remove winner and update wheel
                picked.splice(winIdx, 1);
                spins--;
                document.getElementById('count-text').innerText = `${spins} Spins Left`;
                
                confetti({ particleCount: 120, spread: 70, origin: { y: 0.7 } });

                if (spins > 0) {
                    this.disabled = false;
                    draw();
                } else {
                    setTimeout(() => {
                        document.getElementById('wheel-screen').classList.add('hidden');
                        document.getElementById('log').classList.add('hidden');
                        document.getElementById('final-screen').classList.remove('hidden');
                        won.forEach(w => document.getElementById('final-results').innerHTML += `<div class="res-tag">${w}</div>`);
                    }, 1500);
                }
            }, 5000);
        };
    </script>
</body>
</html>